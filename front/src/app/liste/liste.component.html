<p-toast></p-toast>

<p-dataView #dv [value]="games" [paginator]="true" [rows]="9" filterBy="nom" [sortField]="sortField"
  [sortOrder]="sortOrder" layout="grid">
  <ng-template pTemplate="header">
    <div class="flex flex-column md:flex-row md:justify-content-between">
      <span>
        <button pButton pRipple label="New" icon="pi pi-plus" class="p-button-success mr-2"
          (click)="newGame()"></button>
        <span class="p-input-icon-left mb-2 md:mb-0">
          <i class="pi pi-search"></i>
          <input type="search" pInputText placeholder="Chercher par nom" (input)="dv.filter($any($event.target).value)">
        </span>
      </span>
      <p-dropdown [options]="sortOptions" placeholder="Sort By Price" (onChange)="onSortChange($event)"
        styleClass="mb-2 md:mb-0"></p-dropdown>
      <p-dataViewLayoutOptions></p-dataViewLayoutOptions>
    </div>
  </ng-template>
  <ng-template let-game pTemplate="listItem">
    <div class="col-12">
      <div class="game-list-item">
        <span class="game-favoris">
          <img [src]="getMiniature(game)" [alt]="game.miniature" />
          <i [class]="game.favoris ? 'pi pi-star-fill' : ''"></i>
        </span>
        <div class="game-list-detail">
          <div class="game-name">
            <p-badge class="game-name-badge" [value]="game.status"></p-badge>
            {{game.nom}}
            <!-- <span [class]="'game-badge status-' + game.status.toLowerCase()">{{game.status}}</span> -->
          </div>
          <div class="game-plateforme">
            <p-chip *ngFor="let plateforme of game.plateforme" [label]="plateforme" icon="pi pi-desktop"></p-chip>
            <p-chip *ngFor="let support of game.support" [label]="support" icon="fa fa-compact-disc"></p-chip>
          </div>
          <span class="game-score">{{game.note ? game.note+" / 10" : "Non noté"}}</span>
        </div>
        <div class="game-list-action">
          <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded" label="Modifier"
            (click)="editGame(game)"></button>
          <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger" label="Supprimer"
            (click)="deleteGame(game)"></button>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template let-game pTemplate="gridItem">
    <div class="col-12 md:col-4">
      <div class="game-grid-item card">
        <div class="game-grid-item-top">
          <span class="game-score">{{game.note ? game.note+" / 10" : "Non noté"}}</span>
          <i [class]="(game.favoris ? 'pi pi-star-fill' : '')+' iconFavoris'"></i>
          <p-badge class="game-name-badge" [value]="game.status"></p-badge>
        </div>
        <div class="game-grid-item-content">
          <img [src]="getMiniature(game)" [alt]="game.miniature" />
          <div class="game-name">{{game.nom}}</div>
          <div class="game-plateforme">
            <p-chip *ngFor="let plateforme of game.plateforme" [label]="plateforme" icon="pi pi-desktop"></p-chip>
            <p-chip *ngFor="let support of game.support" [label]="support" icon="fa fa-compact-disc"></p-chip>
          </div>
        </div>
        <div class="game-grid-item-bottom">
          <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded" label="Modifier"
            (click)="editGame(game)"></button>
          <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger" label="Supprimer"
            (click)="deleteGame(game)"></button>
        </div>
      </div>
    </div>
  </ng-template>
</p-dataView>

<p-dialog [(visible)]="gameDialog" [style]="{width: '75%'}" header="Ajout d'un jeu" [modal]="true" styleClass="p-fluid">
  <ng-template pTemplate="content">
    <ng-template [ngIf]="true">
      <p-image [src]="getMiniature(game)" alt="miniature" width="250" [preview]="true"></p-image>
    </ng-template>
    <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="2000000" (onSelect)="onBasicUpload($event)"
      [customUpload]="true" chooseLabel="Choisir une miniature"></p-fileUpload>
    <div class="p-field">
      <label for="name"><b>* </b>Nom</label>
      <input type="text" pInputText id="name" [(ngModel)]="game.nom" required autofocus placeholder="Choisir un nom" />
      <small class="p-error block" *ngIf="!game!.nom">Le nom est obligatoire</small>
    </div>
    <div class="grid p-fluid">
      <div class="col-12 md:col-4">
        <label>Favoris</label><br>
        <p-toggleButton [(ngModel)]="game.favoris" onLabel="Favoris" offLabel="Non favoris" onIcon="pi pi-star-fill"
          offIcon="pi pi-star"></p-toggleButton>
      </div>
      <div class="col-12 md:col-4">
        <label>Note</label>
        <p-inputNumber [(ngModel)]="game.note" mode="decimal" [showButtons]="true" inputId="minmax-buttons" [min]="0"
          [max]="10" [step]="0.5" suffix=" / 10" placeholder="Choisir une note">
        </p-inputNumber>
      </div>
      <div class="col-12 md:col-4">
        <label><b>* </b>Status</label>
        <p-dropdown [options]="listStatus" [(ngModel)]="game.status" placeholder="Choisir un status" [showClear]="true"
          [style]="{width: 'auto'}">
        </p-dropdown>
        <small class="p-error block" *ngIf="!game!.status">Le status est obligatoire</small>
      </div>
    </div>
    <div class="p-field">
      <label><b>* </b>Plateforme(s)</label>
      <p-multiSelect [options]="listPlateformes" [(ngModel)]="game.plateforme"
        defaultLabel="Choisir une(des) plateforme(s)" display="chip"></p-multiSelect>
      <small class="p-error block" *ngIf="!game!.plateforme">Saisir au moins une plateforme</small>
    </div>
    <div class="p-field">
      <label><b>* </b>Support(s)</label>
      <p-multiSelect [options]="listSupports" [(ngModel)]="game.support" defaultLabel="Choisir un(des) support(s)"
        display="chip"></p-multiSelect>
      <small class="p-error block" *ngIf="!game!.support">Saisir au moins un support</small>
    </div>
    <div class="p-field">
      <label for="description">Commentaire</label>
      <textarea id="description" pInputTextarea [(ngModel)]="game!.commentaire" required rows="6" cols="20"></textarea>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Annuler" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton pRipple label="Enregistrer" icon="pi pi-check" class="p-button-text" (click)="saveGame()"></button>
  </ng-template>
</p-dialog>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
